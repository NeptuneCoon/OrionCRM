
@{
    ViewData["Title"] = "Overview";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <link href="~/assets/morris.chart/0.5.1/morris.css" rel="stylesheet" />
    <link href="~/css/chart-extension-rank.css" rel="stylesheet" />
}
@section scripts{
    <script src="~/assets/morris.chart/0.5.1/raphael-min.js"></script>
    <script src="~/assets/morris.chart/0.5.1/morris.min.js"></script>
    <script type="text/javascript">
    /*
    图表的初始化
    */
    $(function () {
        /* 数据格式化 */
        var dataFormat = function (jsonArr) {
            var arr = [];
            if(jsonArr){
                for (var i = 0; i < jsonArr.length; i++) {
                    var item = jsonArr[i];
                    arr.push({ label: item.GroupName, value: item.GroupSaleAmount });
                }
            }
            return arr;
        };

        // 月业绩数据准备
        var monthJsonString = $('#hidMonthSigns').val();
        var month_data = [];
        if (monthJsonString) {
            var jsonArr = JSON.parse(monthJsonString);
            month_data = dataFormat(jsonArr);
        }
        // 年业绩数据准备
        var yearJsonString = $('#hidYearSigns').val();
        var year_data = [];
        if (yearJsonString) {
            var jsonArr = JSON.parse(yearJsonString);
            year_data = dataFormat(jsonArr);
        }

        // 环形图
        if (month_data.length > 0){
            Morris.Donut({
                element: 'month',
                data: month_data,
                formatter: function (y) { return y + "元" }
            });
        }

        // 柱状图
        if (year_data.length > 0) {
            Morris.Bar({
                element: 'year',
                data: year_data,
                xkey: 'label',
                ykeys: ['value'],
                labels: ['业绩'],
                barRatio: 0.4,
                xLabelAngle: 35,
                hideHover: 'auto'
            });
        }
    });
    </script>
}
<h3>业绩概览</h3>
<input type="hidden" id="hidMonthSigns" value="@Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.MonthSigns)" />
<input type="hidden" id="hidYearSigns" value="@Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.YearSigns)" />

<!--当月业绩，环形图-->
<div class="row">
    <div style="width:700px">
        <div class="graph-container">
            <span class="graph-mark">月度</span>
            <div class="caption">当月业绩</div>
            @if (ViewBag.MonthSigns != null && ViewBag.MonthSigns.Count > 0) {
                <div id="month" class="graph" style="position:relative;">
                </div>
            }
            else {
                <div class="by afz" style="padding:20px;">
                    <span style="text-align:center">暂无数据</span>
                </div>
            }
        </div>
    </div>
</div>


<!--本年业绩，柱状图-->
<div class="row">
    <div style="width:700px">
        <div class="graph-container">
            <span class="graph-mark">年度</span>
            <div class="caption">本年业绩(2017-1-1至今)</div>
            @if (ViewBag.YearSigns != null && ViewBag.YearSigns.Count > 0) {
                <div id="year" class="graph" style="position:relative;"></div>
            }
            else {
                <div class="by afz" style="padding:20px;">
                    <span style="text-align:center">暂无数据</span>
                </div>
            }
        </div>
    </div>
</div>

<!--最佳业务排行-->
<div class="row">
    <div style="width:700px">
        <div class="graph-container">
            <span class="graph-mark">业务排行</span>
            <div class="caption">最具潜力业务排行(本月top20)</div>
            <div id="saler" style="padding:20px;width:510px">
                <div class="by afz">
                    @if (ViewBag.RankRecords != null && ViewBag.RankRecords.Count > 0) {
                        foreach (var record in ViewBag.RankRecords) {
                            <a class="rp tr yg" href="#">
                                <span class="azj" style="width: @(record.Percent)%;"></span>
                                <span>@record.SignMan</span>
                                <span class="axn">@(record.Amount)元</span>
                            </a>
                        }
                    }
                    else {
                        <span style="text-align:center">暂无数据</span>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
